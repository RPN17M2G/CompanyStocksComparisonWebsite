import{c as N,r as a,j as e,T as z,a as u,C as O,b as x,F as $,S as Q,M as _,G as U,B as b,I as J,d as K,e as X,f as Y,h as Z,i as ee,k as se,l as te,n as re,o as ae,p as ie,R as oe,q as v,D as le,s as ne,t as ce,u as de,v as F,w as he,x as xe,y as ue,z as be,A as me}from"./index-CxXP2gN5.js";/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pe=N("RotateCcw",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ge=N("Save",[["path",{d:"M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z",key:"1owoqh"}],["polyline",{points:"17 21 17 13 7 13 7 21",key:"1md35c"}],["polyline",{points:"7 3 7 8 15 8",key:"8nz8an"}]]),W=a.memo(({config:t,updateMetricConfig:n})=>{const m=a.useCallback(()=>{n(t.id,{isVisible:!t.isVisible})},[t.id,t.isVisible,n]),f=a.useCallback(i=>{n(t.id,{priority:Number(i.target.value)})},[t.id,n]);return e.jsxs(z,{hover:!0,sx:{backgroundColor:"transparent","&:hover":{backgroundColor:i=>i.palette.mode==="dark"?"rgba(255, 255, 255, 0.05)":"rgba(0, 0, 0, 0.02)"}},children:[e.jsx(u,{children:e.jsx(O,{checked:t.isVisible,onChange:m,size:"small"})}),e.jsx(u,{children:e.jsx(x,{variant:"body2",children:t.name})}),e.jsx(u,{children:e.jsx(x,{variant:"caption",color:"text.secondary",children:t.format})}),e.jsx(u,{children:e.jsx($,{size:"small",fullWidth:!0,children:e.jsx(Q,{value:t.priority,onChange:f,children:[0,1,2,3,4,5,6,7,8,9,10].map(i=>e.jsx(_,{value:i,children:i},i))})})})]})});W.displayName="MetricConfigRow";const V=30,q=a.memo(({group:t,isExpanded:n,onToggle:m,updateMetricConfig:f})=>{const[i,C]=a.useState(V);a.useEffect(()=>{n&&C(V)},[n]);const S=a.useCallback(()=>{m(t.category)},[t.category,m]),D=a.useCallback(()=>{(o=>{"requestIdleCallback"in window?requestIdleCallback(o,{timeout:100}):setTimeout(o,50)})(()=>{C(o=>Math.min(o+V,t.allMetrics.length))})},[t.allMetrics.length]),j=a.useMemo(()=>t.directMetrics.slice(0,i),[t.directMetrics,i]),k=a.useMemo(()=>{const c={};let o=t.directMetrics.length;for(const[h,p]of Object.entries(t.subcategories)){if(o>=i)break;const g=i-o;g>0&&(c[h]=p.slice(0,g),o+=Math.min(g,p.length))}return c},[t.subcategories,t.directMetrics.length,i]),M=j.length+Object.values(k).reduce((c,o)=>c+o.length,0),w=M<t.allMetrics.length;return e.jsxs(U,{sx:{mb:2,mx:2,mt:2,overflow:"hidden"},children:[e.jsx(b,{sx:{p:1.5,display:"flex",alignItems:"center",justifyContent:"space-between",cursor:"pointer","&:hover":{bgcolor:"action.hover"},borderBottom:n?"1px solid":"none",borderColor:"divider"},onClick:S,children:e.jsxs(b,{sx:{display:"flex",alignItems:"center",gap:1,flex:1},children:[e.jsx(J,{size:"small",sx:{p:.5},children:n?e.jsx(K,{size:20}):e.jsx(X,{size:20})}),e.jsx(x,{variant:"subtitle1",fontWeight:"bold",color:"primary",children:t.category}),e.jsx(Y,{label:`${t.allMetrics.length} metrics`,size:"small",variant:"outlined",sx:{height:20,fontSize:"0.7rem"}})]})}),e.jsx(Z,{in:n,children:e.jsx(ee,{sx:{backgroundColor:"transparent","& .MuiTable-root":{backgroundColor:"transparent"},"& .MuiTableHead-root":{backgroundColor:"transparent"},"& .MuiTableBody-root":{backgroundColor:"transparent"},"& .MuiTableCell-root":{backgroundColor:"transparent",borderColor:"divider"}},children:e.jsxs(se,{size:"small",children:[e.jsx(te,{children:e.jsxs(z,{children:[e.jsx(u,{sx:{width:50},children:"Visible"}),e.jsx(u,{children:"Metric Name"}),e.jsx(u,{sx:{width:100},children:"Format"}),e.jsx(u,{sx:{width:150},children:e.jsxs(b,{sx:{display:"flex",alignItems:"center",gap:.5},children:["Priority",e.jsx(re,{title:e.jsxs(b,{sx:{p:.5},children:[e.jsx(x,{variant:"body2",sx:{mb:1,fontWeight:"bold"},children:"Priority System Explained:"}),e.jsxs(x,{variant:"body2",component:"div",sx:{mb:.5},children:["• ",e.jsx("strong",{children:"Higher priority (10)"})," = Appears first in the table"]}),e.jsxs(x,{variant:"body2",component:"div",sx:{mb:.5},children:["• ",e.jsx("strong",{children:"Lower priority (1)"})," = Appears later in the table"]}),e.jsxs(x,{variant:"body2",component:"div",sx:{mb:.5},children:["• ",e.jsx("strong",{children:"Priority 0"})," = Hides the metric completely"]}),e.jsx(x,{variant:"body2",component:"div",children:"Metrics are sorted by priority (high to low), then by category and name."})]}),arrow:!0,placement:"top",children:e.jsx(ae,{size:16,style:{cursor:"help",opacity:.7,color:"inherit"}})})]})})]})}),e.jsxs(ie,{children:[j.map(c=>e.jsx(W,{config:c,updateMetricConfig:f},c.id)),Object.entries(k).map(([c,o])=>e.jsxs(oe.Fragment,{children:[e.jsx(z,{children:e.jsx(u,{colSpan:4,sx:{backgroundColor:h=>h.palette.mode==="dark"?"rgba(255, 255, 255, 0.03)":"rgba(0, 0, 0, 0.02)",py:.5},children:e.jsx(x,{variant:"caption",fontWeight:"medium",color:"text.secondary",children:c})})}),o.map(h=>e.jsx(W,{config:h,updateMetricConfig:f},h.id))]},c)),w&&e.jsx(z,{children:e.jsx(u,{colSpan:4,align:"center",sx:{py:2},children:e.jsxs(v,{variant:"outlined",size:"small",onClick:D,children:["Load more (",t.allMetrics.length-M," remaining)"]})})})]})]})})})]})});q.displayName="CategorySection";function je({open:t,onClose:n,metricConfigs:m,updateMetricConfig:f,setMetricConfigs:i,onTemplateSaved:C}){const[S,D]=a.useState(""),j=a.useDeferredValue(S),[k,M]=a.useState(new Set),[w,c]=a.useTransition(),[o,h]=a.useState(!1),[p,g]=a.useState(""),[P,T]=a.useState(""),[I,A]=a.useState(!1),R=a.useMemo(()=>{if(!t)return[];const s=j.toLowerCase().trim(),d=new Map;for(const r of m.values()){if(s&&!`${r.name} ${r.category} ${r.format} ${r.subcategory||""}`.toLowerCase().includes(s))continue;d.has(r.category)||d.set(r.category,{subcategories:new Map,directMetrics:[]});const l=d.get(r.category);r.subcategory?(l.subcategories.has(r.subcategory)||l.subcategories.set(r.subcategory,[]),l.subcategories.get(r.subcategory).push(r)):l.directMetrics.push(r)}return Array.from(d.entries()).map(([r,l])=>({category:r,subcategories:Object.fromEntries(l.subcategories),directMetrics:l.directMetrics,allMetrics:[...l.directMetrics,...Array.from(l.subcategories.values()).flat()]}))},[m,j,t]);a.useEffect(()=>{j&&k.size===0&&R.length>0&&M(new Set(R.map(s=>s.category)))},[j]);const E=a.useCallback(s=>{M(d=>{const r=new Set(d);return r.has(s)?r.delete(s):r.add(s),r})},[]),H=()=>{c(()=>{i(s=>{const d=new Map(s);for(const[r,l]of d.entries())d.set(r,{...l,isVisible:!0,priority:5});return d})})},L=()=>{if(!p.trim())return;const s=Array.from(m.values()).filter(y=>y.isVisible&&y.priority>0).map(y=>y.id),d={},r=[],l=new Set;m.forEach((y,G)=>{r.push(G),d[G]=y.priority,y.category&&l.add(y.category)});const B=be(p.trim(),P.trim()||void 0,r,d,s,Array.from(l));me(B),A(!0),C&&C(),setTimeout(()=>{h(!1),g(""),T(""),A(!1)},1500)};return e.jsxs(e.Fragment,{children:[e.jsx(le,{open:t,onClose:n,maxWidth:"xl",fullWidth:!0,BackdropProps:{sx:{backdropFilter:"blur(5px)"}},PaperProps:{sx:{backgroundColor:"transparent",boxShadow:"none"}},children:e.jsxs(b,{sx:{borderRadius:4,backgroundColor:s=>s.palette.mode==="dark"?"rgba(18, 30, 54, 0.85)":"rgba(255, 255, 255, 0.85)",backdropFilter:"blur(10px)",boxShadow:s=>s.shadows[10],border:"1px solid",borderColor:s=>s.palette.mode==="dark"?"rgba(255, 255, 255, 0.1)":"rgba(0, 0, 0, 0.1)",maxHeight:"90vh",display:"flex",flexDirection:"column",overflow:"hidden"},children:[e.jsxs(ne,{sx:{position:"sticky",top:0,zIndex:10,backgroundColor:s=>s.palette.mode==="dark"?"rgba(11, 17, 32, 0.8)":"rgba(248, 250, 252, 0.8)",backdropFilter:"blur(10px)",borderBottom:1,borderColor:"divider",display:"flex",justifyContent:"space-between",alignItems:"center",pb:1},children:[e.jsx(x,{component:"span",sx:{fontSize:"1.25rem",fontWeight:500},children:"Configure GRID"}),e.jsxs(b,{sx:{display:"flex",gap:1},children:[e.jsx(v,{startIcon:e.jsx(ge,{size:16}),onClick:()=>h(!0),variant:"outlined",size:"small",color:"primary",children:"Save as Template"}),e.jsx(v,{startIcon:e.jsx(pe,{size:16}),onClick:H,variant:"outlined",size:"small",disabled:w,children:"Reset to All Metrics"})]})]}),e.jsxs(ce,{sx:{...de,flex:1,overflow:"auto",p:0},children:[e.jsx(b,{sx:{p:2,borderBottom:"1px solid",borderColor:"divider"},children:e.jsx(F,{fullWidth:!0,size:"small",placeholder:"Search metrics...",onChange:s=>D(s.target.value),value:S})}),w&&e.jsx(b,{sx:{display:"flex",justifyContent:"center",p:2},children:e.jsx(he,{size:24})}),R.map(s=>e.jsx(q,{group:s,isExpanded:k.has(s.category),onToggle:E,updateMetricConfig:f},s.category))]}),e.jsx(xe,{sx:{position:"sticky",bottom:0,zIndex:10,backgroundColor:s=>s.palette.mode==="dark"?"rgba(11, 17, 32, 0.8)":"rgba(248, 250, 252, 0.8)",backdropFilter:"blur(10px)",borderTop:1,borderColor:"divider",p:2},children:e.jsx(v,{onClick:n,variant:"contained",children:"Close"})})]})}),e.jsx(ue,{open:o,onClose:()=>{h(!1),g(""),T("")},title:I?"Template Saved Successfully!":"Save Grid as Template",maxWidth:"sm",fullWidth:!0,actions:I?void 0:e.jsxs(e.Fragment,{children:[e.jsx(v,{onClick:()=>{h(!1),g(""),T("")},children:"Cancel"}),e.jsx(v,{onClick:L,variant:"contained",disabled:!p.trim(),children:"Save Template"})]}),children:I?e.jsx(b,{sx:{display:"flex",flexDirection:"column",alignItems:"center",gap:2,py:2},children:e.jsxs(x,{variant:"body1",color:"success.main",sx:{fontWeight:600},children:['"',p,'" has been saved and is now available in the Templates menu.']})}):e.jsxs(b,{sx:{display:"flex",flexDirection:"column",gap:2},children:[e.jsx(F,{fullWidth:!0,label:"Template Name",value:p,onChange:s=>g(s.target.value),placeholder:"e.g., My Custom View",required:!0,autoFocus:!0}),e.jsx(F,{fullWidth:!0,label:"Description (Optional)",value:P,onChange:s=>T(s.target.value),placeholder:"Describe this template...",multiline:!0,rows:3})]})})]})}export{je as MetricConfigDialog};
